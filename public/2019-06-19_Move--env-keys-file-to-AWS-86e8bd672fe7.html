<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Move .env keys file to AWS</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Move .env keys file to AWS</h1>
</header>
<section data-field="subtitle" class="p-summary">
This will help you centralize your Environments key management (esp for Laravel)
</section>
<section data-field="body" class="e-content">
<section name="76a9" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7e43" id="7e43" class="graf graf--h3 graf--leading graf--title">Move .env keys file to AWS</h3><p name="e7d8" id="e7d8" class="graf graf--p graf-after--h3">This will help you centralize your Environments key management (esp for Laravel)</p><figure name="cda0" id="cda0" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 525px; max-height: 525px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*F5Tlo-uIrM55tZcJ3TMB2g.jpeg" data-width="1500" data-height="1500" data-is-featured="true" src="https://cdn-images-1.medium.com/max/600/1*F5Tlo-uIrM55tZcJ3TMB2g.jpeg"></div></figure><p name="ad97" id="ad97" class="graf graf--p graf-after--figure">A while ago we realized in my company that we don&#39;t store env keys (aka .env file)in the best secure way, and just like every company‘s main rule</p><blockquote name="4e0e" id="4e0e" class="graf graf--blockquote graf--hasDropCapModel graf-after--p">Try as much as possible to keep sensitive keys from developers machines esp if they work from home.</blockquote><p name="6563" id="6563" class="graf graf--p graf-after--blockquote">So, we decided to put all environment keys (aka .env file) in one place that is secure but only accessible to those who have credentials.</p><p name="db82" id="db82" class="graf graf--p graf-after--p">If you’re an AWS guy, you guessed it already. Yes, we moved to AWS `Parameter Store`.</p><h3 name="d609" id="d609" class="graf graf--h3 graf-after--p">How Does AWS Parameter Store Works</h3><p name="5efe" id="5efe" class="graf graf--p graf-after--h3">AWS Parameter Store actually acts as an env file that is split into multiple files and those files are called ‘paths’. so, let&#39;s say you need an env SERVICE_KEY for each env (production, staging..)</p><p name="49ec" id="49ec" class="graf graf--p graf-after--p">So you will be stored in there as follow:</p><pre name="a4c0" id="a4c0" class="graf graf--pre graf-after--p">/production/SERVICE_KEY<br>and another one for staging<br>/staging/SERVICE_KEY</pre><p name="2f4f" id="2f4f" class="graf graf--p graf-after--pre">And when you want that Env, you just have to provide the main path. so, if you want the production ones you can say give me whats under `/production`.</p><h3 name="5d5a" id="5d5a" class="graf graf--h3 graf-after--p">What Did We Have</h3><p name="c97e" id="c97e" class="graf graf--p graf-after--h3">We had multiple environment keys for multiple regions and multiple types of servers (Development/QA/Staging/Production).</p><p name="f9d0" id="f9d0" class="graf graf--p graf-after--p">So, we divided those Envs in that order and in the same division of regions.</p><blockquote name="0432" id="0432" class="graf graf--blockquote graf-after--p">/production/sa-east-1, /production/ap-southeast-1</blockquote><p name="5587" id="5587" class="graf graf--p graf-after--blockquote">and we did the same for those Envs that needs region</p><blockquote name="6dfb" id="6dfb" class="graf graf--blockquote graf-after--p">/staging/… , /qa/…</blockquote><h3 name="81b0" id="81b0" class="graf graf--h3 graf-after--blockquote">How Did We Do It</h3><ul class="postList"><li name="c2b0" id="c2b0" class="graf graf--li graf-after--h3">Stored everything in AWS first either using the <a href="https://eu-west-1.console.aws.amazon.com/systems-manager/parameters?region=eu-west-1" data-href="https://eu-west-1.console.aws.amazon.com/systems-manager/parameters?region=eu-west-1" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">AWS Console</a> or <a href="https://docs.aws.amazon.com/cli/latest/reference/ssm/index.html" data-href="https://docs.aws.amazon.com/cli/latest/reference/ssm/index.html" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">CLI</a>.</li><li name="91c7" id="91c7" class="graf graf--li graf-after--li">In our case we did a bulk insert by just making a script to change all values and make them into a command like the one below, then ran them all.<br>The Command for putting keys:<code class="markup--code markup--li-code"><br>aws ssm put-parameter — name “/qa/SOME_KEY” — type “String” — value “KEY_VALUE&quot;</code></li><li name="1863" id="1863" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">Then we setup our deployment script to fetch the needed env based on the build and based on that env (ex. staging) we fetch the right env values. ex of fetch below:</code></li></ul><pre name="9d6f" id="9d6f" class="graf graf--pre graf-after--li">aws ssm get-parameters-by-path — path “/staging” — query “Parameters[*].[Name,’=’,Value]” — region eu-west-1 — output text | sed ‘s/[[:blank:]]//g’ | sed “s/\/staging\///g”<br><br></pre><p name="1043" id="1043" class="graf graf--p graf-after--pre">and we store the output in a file or something</p><pre name="7352" id="7352" class="graf graf--pre graf-after--p">Ex. {CommandAbove} &gt; staging.env</pre><h3 name="fdc9" id="fdc9" class="graf graf--h3 graf-after--pre">Improvement</h3><p name="a91e" id="a91e" class="graf graf--p graf-after--h3 graf--trailing">Give your server a permission to access SSM (parameter store permissions), allow it to access those keys and never even generate a file and just use them by calling the SSM API for that key programmatically whenever you need it.</p></div></div></section><section name="07ad" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="9f01" id="9f01" class="graf graf--h4 graf--leading">To read more about this please check</h4><div name="8be2" id="8be2" class="graf graf--mixtapeEmbed graf-after--h4"><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" data-href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html"><strong class="markup--strong markup--mixtapeEmbed-strong">AWS Systems Manager Parameter Store - AWS Systems Manager</strong><br><em class="markup--em markup--mixtapeEmbed-em">AWS Systems Manager Parameter Store provides secure, hierarchical storage for configuration data management and secrets…</em>docs.aws.amazon.com</a><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="4e285ed287aae506fa87d1a828c1f4b6" data-thumbnail-img-id="0*31g3PF9d4cbL5o3a" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*31g3PF9d4cbL5o3a);"></a></div><h3 name="05d8" id="05d8" class="graf graf--h3 graf-after--mixtapeEmbed">All In All</h3><p name="c1cd" id="c1cd" class="graf graf--p graf-after--h3">Doing whats above enabled us to change the way we manage our key, and made our life way easier where before some changes might’ve required new releases or 2 releases to change keys before doing the main release.</p><p name="a270" id="a270" class="graf graf--p graf-after--p graf--trailing">All of that is gone now, and there’s one place that can welcome them all.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abidul.rmdn" class="p-author h-card">Abidul Ramadan</a> on <a href="https://medium.com/p/86e8bd672fe7"><time class="dt-published" datetime="2019-06-19T11:05:04.020Z">June 19, 2019</time></a>.</p><p><a href="https://medium.com/@abidul.rmdn/move-env-keys-file-to-aws-86e8bd672fe7" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 28, 2019.</p></footer></article></body></html>