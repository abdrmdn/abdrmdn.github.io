<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>A Team of Mac-book Docker users amazing solution</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">A Team of Mac-book Docker users amazing solution</h1>
</header>
<section data-field="subtitle" class="p-summary">
Actionable/theoretical : actionable
</section>
<section data-field="body" class="e-content">
<section name="2c9c" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="11a6" id="11a6" class="graf graf--figure graf--leading"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*AOiMWUbJ02WpO_aNaaLPfA.png" data-width="2100" data-height="1182" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*AOiMWUbJ02WpO_aNaaLPfA.png"></div></figure><h3 name="9554" id="9554" class="graf graf--h3 graf-after--figure graf--title">A Team of Mac-book Docker users amazing solution</h3><p name="7a19" id="7a19" class="graf graf--p graf-after--h3"><em class="markup--em markup--p-em">Actionable/theoretical : actionable</em></p><h3 name="5cc0" id="5cc0" class="graf graf--h3 graf-after--p">INTRO</h3><p name="eb21" id="eb21" class="graf graf--p graf-after--h3">We at <a href="https://studocu.com" data-href="https://studocu.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">StuDocu</a> strive to keep developing code faster, one of the main ways of achieving this is to have a fast working environment.</p><p name="5a2b" id="5a2b" class="graf graf--p graf-after--p">Now, since most of our developers are using MacBooks, and we have a huge stack that does millions of things; running docker on MacBook was a NO solution since it will be tremendously slow and resource consuming.</p><p name="901f" id="901f" class="graf graf--p graf-after--p">So we needed a solution that will help us speed things up. Our office server jumped for help. Thing is we have this server at the office which can be used as a web server. But, we ain’t using it! So we said what the hell!</p><blockquote name="3745" id="3745" class="graf graf--pullquote graf-after--p">Lets use it!</blockquote><h3 name="839e" id="839e" class="graf graf--h3 graf-after--pullquote">Solution For Our Problem</h3><p name="c295" id="c295" class="graf graf--p graf-after--h3">We thought to ourselves since Docker runs most efficiently on Linux, lets setup the office-server with Linux and do a docker in docker instances.</p><p name="ee4a" id="ee4a" class="graf graf--p graf-after--p">Meaning, we run docker container for each developer.</p><ul class="postList"><li name="8340" id="8340" class="graf graf--li graf-after--p">developer1-container</li><li name="81f5" id="81f5" class="graf graf--li graf-after--li">developer2-container</li><li name="09c6" id="09c6" class="graf graf--li graf-after--li">…</li></ul><p name="cd88" id="cd88" class="graf graf--p graf-after--li">And each developer’s container would run the whole stack inside.</p><p name="5ee0" id="5ee0" class="graf graf--p graf-after--p">Since the IP is accessible by all, each was assigned a port to use for his environment and 1 command that will sync his/her local code to the server (very minimal sync, since we only sync changed files).</p><p name="61e4" id="61e4" class="graf graf--p graf-after--p">This allowed everyone to run his environment at full speed.</p><h3 name="457e" id="457e" class="graf graf--h3 graf-after--p">The solution in Technical Details</h3><h4 name="373f" id="373f" class="graf graf--h4 graf-after--h3">Creating users</h4><p name="a7ed" id="a7ed" class="graf graf--p graf-after--h4">First, we had to create users for each developer in the server, and add his ssh keys in there so that the sync/access later is possible.</p><h4 name="7941" id="7941" class="graf graf--h4 graf-after--p">Developers Main Containers Setup</h4><p name="6c49" id="6c49" class="graf graf--p graf-after--h4">We created a docker-compose file that has each of the developers’ instances in it and mounted each of the Env ports to a different port that is unique than others. Of course, doing this manually can be tedious. So we made an Ansible script playbook that checks used ports then assigns the next best thing for each user.</p><blockquote name="9214" id="9214" class="graf graf--blockquote graf-after--p">Ex.<br><strong class="markup--strong markup--blockquote-strong">Developer1-container</strong><br>- port 80: 1080<br>- port 443: 1443</blockquote><blockquote name="6f7c" id="6f7c" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong">Developer2-container</strong><br>- port 80: 2000<br>- port 443: 2443</blockquote><p name="d749" id="d749" class="graf graf--p graf-after--blockquote">Each of those containers has the app <a href="https://www.cis.upenn.edu/~bcpierce/unison/" data-href="https://www.cis.upenn.edu/~bcpierce/unison/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">unison</a> which will help real-time syncing changed files by each developer later on.</p><h4 name="5424" id="5424" class="graf graf--h4 graf-after--p">Each Containers Setup</h4><p name="8a66" id="8a66" class="graf graf--p graf-after--h4">This part is straight forward, our Ansible playbook (<em class="markup--em markup--p-em">any other script type u prefer to do this dynamically instead of manually</em>) will clone our environment inside the container just like if you’re doing it on your laptop.</p><p name="a393" id="a393" class="graf graf--p graf-after--p">Basically:</p><ul class="postList"><li name="74a9" id="74a9" class="graf graf--li graf-after--p">git clone repositories</li><li name="fb70" id="fb70" class="graf graf--li graf-after--li">docker-compose up all your containers</li></ul><h4 name="46f1" id="46f1" class="graf graf--h4 graf-after--li">Developer side</h4><p name="0252" id="0252" class="graf graf--p graf-after--h4">So what we did is that we created a repo that has a the Ansible scripts, which creates a user, ups the developers’ container, run the internal environment and start syncing files.</p><p name="9a85" id="9a85" class="graf graf--p graf-after--p">Syncing files wasn’t that big of a deal as mentioned before we used <a href="https://www.cis.upenn.edu/~bcpierce/unison/" data-href="https://www.cis.upenn.edu/~bcpierce/unison/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">unison</a>. (which has its own file watcher) But in our case, we faced some issues with its file watcher, so we made a small script that watches files and then runs unison to sync the latest changes both ways.</p><p name="440e" id="440e" class="graf graf--p graf-after--p">The script can be as simple as:</p><pre name="be8c" id="be8c" class="graf graf--pre graf-after--p">fswatch -r --event Updated ./ | while read x; do<br>        unison ./ ssh://username<a href="mailto:1@local.studocu.com" data-href="mailto:1@local.studocu.com" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">@s</a>erver/pathToSyncTo -batch -perms=0 -prefer newer -ignore=&quot;Name somefile/foldername&quot;</pre><p name="33c4" id="33c4" class="graf graf--p graf-after--pre">of course, you can play around with the script based on your environments.</p><h3 name="dce3" id="dce3" class="graf graf--h3 graf-after--p">Pros and Cons Of This Solution</h3><h4 name="e69e" id="e69e" class="graf graf--h4 graf-after--h3">Pros</h4><ul class="postList"><li name="bc6a" id="bc6a" class="graf graf--li graf-after--h4">Fast environments.</li><li name="3bf5" id="3bf5" class="graf graf--li graf-after--li">1 type of maintenance, people will always face the same issues since its the same machine.</li><li name="055f" id="055f" class="graf graf--li graf-after--li">Developers machines can survive longer cause it’s not exhausting.</li><li name="5c0a" id="5c0a" class="graf graf--li graf-after--li">No need for everyone to have hands-on experience with docker, only few who are helping with this setup.</li></ul><h4 name="ccf3" id="ccf3" class="graf graf--h4 graf-after--li">Cons</h4><ul class="postList"><li name="7230" id="7230" class="graf graf--li graf-after--h4">1 point of failure (which didn’t happen but once to us).</li><li name="d6f4" id="d6f4" class="graf graf--li graf-after--li graf--trailing">People cant really work remotely with this unless you do fancy setup on top of this.</li></ul></div></div></section><section name="d44e" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7ea8" id="7ea8" class="graf graf--h3 graf--leading">Summary</h3><p name="c81a" id="c81a" class="graf graf--p graf-after--h3">In general, this served us quite well. Until we switched to a better Docker in a Virtual machine solution which you can read later in our tech blog.</p><p name="0349" id="0349" class="graf graf--p graf-after--p graf--trailing">This can be labeled under DinD solutions, which works perfectly for some and doesn’t for others.</p></div></div></section><section name="561d" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="d8b5" id="d8b5" class="graf graf--p graf--leading">Brought to you by</p><figure name="493f" id="493f" class="graf graf--figure graf-after--p graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 283px; max-height: 60px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 21.2%;"></div><img class="graf-image" data-image-id="1*hcVfm8Q2DTuvDfO9QTbSsA.png" data-width="283" data-height="60" src="https://cdn-images-1.medium.com/max/800/1*hcVfm8Q2DTuvDfO9QTbSsA.png"></div></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abidul.rmdn" class="p-author h-card">Abidul Ramadan</a> on <a href="https://medium.com/p/fe9592247d21"><time class="dt-published" datetime="2019-05-27T12:57:23.399Z">May 27, 2019</time></a>.</p><p><a href="https://medium.com/@abidul.rmdn/a-team-of-mac-book-docker-users-amazing-solution-fe9592247d21" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 28, 2019.</p></footer></article></body></html>