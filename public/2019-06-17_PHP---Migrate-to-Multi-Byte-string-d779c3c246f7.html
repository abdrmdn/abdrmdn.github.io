<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>PHP — Migrate to Multi-Byte string</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">PHP — Migrate to Multi-Byte string</h1>
</header>
<section data-field="subtitle" class="p-summary">
Easily migrate to mb_ string functions in php
</section>
<section data-field="body" class="e-content">
<section name="fab1" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="ec47" id="ec47" class="graf graf--h3 graf--leading graf--title">PHP — Migrate to Multi-Byte string functions</h3><p name="5844" id="5844" class="graf graf--p graf-after--h3">Easily migrate to mb_ string functions in PHP</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="1076" id="1076" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 539px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.300000000000004%;"></div><img class="graf-image" data-image-id="1*jbFWcnSlZ6NU4p7GPjJomA.jpeg" data-width="1200" data-height="627" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*jbFWcnSlZ6NU4p7GPjJomA.jpeg"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="f3bb" id="f3bb" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--figure"><span class="graf-dropCap">A</span> while ago we decided to do a migration from normal string functions to multi-byte functions like `mb_substr` and other mb_* functions cause we wanted to support Korean and other Asian languages in our platform.</p><h4 name="b02f" id="b02f" class="graf graf--h4 graf-after--p">Multi-byte Functions</h4><p name="baa7" id="baa7" class="graf graf--p graf-after--h4">PHP by default doesn’t support multi-byte strings, meaning if you put a char that has the size of 2 bytes it would process it weirdly and give you unexpected results.</p><h3 name="6b0e" id="6b0e" class="graf graf--h3 graf-after--p">HOW DID WE DO IT</h3><p name="ccc1" id="ccc1" class="graf graf--p graf-after--h3">We ran a script ;)</p><p name="0a09" id="0a09" class="graf graf--p graf-after--p">The script below basically looks for all functions that must be multi-byte sensitive and replaces them with the mb_ alternative.</p><pre name="f649" id="f649" class="graf graf--pre graf-after--p">#!/bin/bash</pre><pre name="497f" id="497f" class="graf graf--pre graf-after--pre">export NON_MB_FUNCTIONS=&quot;strtolower check_encoding chr convert_case convert_encoding convert_kana convert_variables decode_mimeheader decode_numericentity detect_encoding detect_order encode_mimeheader encode_numericentity encoding_aliases ereg_match ereg_replace_callback ereg_replace ereg_search_getpos ereg_search_getregs ereg_search_init ereg_search_pos ereg_search_regs ereg_search_setpos ereg_search ereg eregi_replace eregi get_info http_input http_output internal_encoding language list_encodings ord output_handler parse_str preferred_mime_name regex_encoding regex_set_options scrub send_mail split strcut strimwidth stripos stristr strlen strpos strrchr strrichr strripos strrpos strstr strtolower strtoupper strwidth substitute_character substr_count substr&quot;</pre><pre name="8f49" id="8f49" class="graf graf--pre graf-after--pre">find $1 -type f -name &quot;*.php&quot;  &gt; phpfiles.list <br>for FUNC in $NON_MB_FUNCTIONS<br>do<br>     echo &quot;Replacing $FUNC with mb_$FUNC&quot;<br>     cat phpfiles.list | while read PHPFILE<br>     do<br>        sed -i &quot;s/\b$FUNC(/mb_$FUNC(/g&quot; $PHPFILE<br>     done     <br>     echo &quot;------------------------&quot;<br>done</pre><p name="982d" id="982d" class="graf graf--p graf-after--pre">You store this script in a .sh file, give it executable mode</p><blockquote name="2d06" id="2d06" class="graf graf--blockquote graf-after--p">chmod +x scriptfile.sh</blockquote><p name="eb40" id="eb40" class="graf graf--p graf-after--blockquote">Then run it with the path you want to scout and replace all functions in. ex.</p><blockquote name="9e35" id="9e35" class="graf graf--blockquote graf-after--p">replacetomb.sh ./</blockquote><h3 name="c13f" id="c13f" class="graf graf--h3 graf-after--blockquote">PHP Default Support</h3><p name="a304" id="a304" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Yes,</strong> you can use function Overloading (in the past though) cause its deprecated and it causes issues</p><div name="a08f" id="a08f" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.php.net/manual/en/mbstring.overload.php" data-href="https://www.php.net/manual/en/mbstring.overload.php" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.php.net/manual/en/mbstring.overload.php"><strong class="markup--strong markup--mixtapeEmbed-strong">PHP: Function Overloading Feature — Manual</strong><br><em class="markup--em markup--mixtapeEmbed-em">mbstring supports a ‘function overloading’ feature which enables you to add multibyte awareness to such an application…</em>www.php.net</a><a href="https://www.php.net/manual/en/mbstring.overload.php" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="01e917a03198075df72be58219f6420e" data-thumbnail-img-id="0*uc7zCHs2duQB_AMJ" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*uc7zCHs2duQB_AMJ);"></a></div><p name="b0f1" id="b0f1" class="graf graf--p graf-after--mixtapeEmbed">what this does, is that it automatically process string functions as multi-byte functions. and this just needs to be enabled by the PHP INI file.</p><p name="0ab1" id="0ab1" class="graf graf--p graf-after--p">But, since it&#39;s pretty risky, PHP people decided to disable this and force those who want multi-byte to explicitly use mb_ functions.</p><h3 name="a2a0" id="a2a0" class="graf graf--h3 graf-after--p">All In All</h3><p name="7e43" id="7e43" class="graf graf--p graf-after--h3">If you don’t really need those I’d suggest not to use mb_ functions cause this means more memory being used in your application for no used purpose.</p><p name="db92" id="db92" class="graf graf--p graf-after--p">and if you run the script, make sure you put a rule for it in your code sniffer, so people won&#39;t use old functions again.</p><p name="2d3d" id="2d3d" class="graf graf--p graf-after--p graf--trailing">And as always, hope this was useful to you. :)</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abidul.rmdn" class="p-author h-card">Abidul Ramadan</a> on <a href="https://medium.com/p/d779c3c246f7"><time class="dt-published" datetime="2019-06-17T10:58:14.029Z">June 17, 2019</time></a>.</p><p><a href="https://medium.com/@abidul.rmdn/php-migrate-to-multi-byte-string-d779c3c246f7" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 28, 2019.</p></footer></article></body></html>